{% extends "base.html" %}
{% load static %}

{% block title %}All Tasks{% endblock %}

{% block content %}
	<h1 class="h1 text-center">Liste des Taches</h1>
	<div class="container mt-5">
        <div class="row row-cols-1 row-cols-md-3 g-4">
        	{% for task in tasks %}
				<div class="col" id="task-{{ task.id }}">
				    <div class="card border-primary mb-3">
				        <div class="card-header bg-transparent border-primary d-flex justify-content-between align-items-center">
				            <span>{{ task.title }} </span>
				            <span class="badge {% if task.status == 'encours' %} btn-sucess {% else %} bg-danger {% endif %}">{{ task.status }}</span>
				        </div>
				        <div class="card-body text-primary">
				            <span class="card-title text-black my-2">depuis: {{ task.created|timesince }}</span>
				            <p>{{ task.content }}</p>
				        </div>
				        <div class="card-footer bg-transparent border-primary d-flex justify-content-between align-items-center">
				            <span class="text-muted">Par: {{ task.author.username }}</span>  <div>  <button type="button" class="btn btn-sm btn-outline-primary me-2"><i class="fas fa-edit"></i> Modifier</button>
				                <button type="button" class="btn btn-sm btn-danger" onclick="deleteTask({{ task.id }})"><i class="fas fa-trash-alt"></i> Supprimer</button>
				            </div>
				        </div>
				    </div>
				</div>
			{% endfor %}
        </div>
    </div>

{% endblock %}
   <style>
        .card {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add a subtle shadow */
            transition: transform 0.2s; /* Add a hover effect */
        }

        .card:hover {
            transform: translateY(-5px); /* Move card up slightly on hover */
        }

        .card-footer .btn {
            margin: 0 5px; /* Add some spacing between buttons */
        }
        .list-group-item{
            display: flex;
            align-items: center; /* Align items vertically */
        }
        .list-group-item input[type="checkbox"] {
            margin-right: 10px; /* Add space between checkbox and text */
        }

         h6 {
      display: inline-block;
       width: fit-content;
        white-space: nowrap;
    }
    </style>


{% block js %}
<script>
  function deleteTask(taskId) {
    if (confirm("Êtes-vous sûr de vouloir supprimer cette tâche ?")) {
      fetch(`/task/delete/${taskId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'), // Important pour Django
          'Content-Type': 'application/json'
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          // Supprimer l'élément de la tâche de la page
          const taskElement = document.getElementById(`task-${taskId}`);
          if (taskElement) {
            taskElement.remove();
            alert("Tâche supprimée avec succès.");
          }
        } else {
          alert("Erreur lors de la suppression de la tâche.");
          console.error("Erreur lors de la suppression :", data.message); 
          alert(`Erreur lors de la suppression de la tâche: ${data.message}`); // 
        }
      });
    }
  }

  // Fonction pour récupérer le token CSRF (nécessaire pour Django)
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Est-ce que ce cookie correspond au nom que nous recherchons ?
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
{% endblock %}